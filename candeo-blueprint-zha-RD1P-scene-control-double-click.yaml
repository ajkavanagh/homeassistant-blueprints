blueprint:
  name: Candeo C-ZB-RD1P (REM or DPM mode) - Scene/Script Control
  description: >
    **Scene and script control for C-ZB-RD1P (Remote Mode or Dual Purpose Mode) using ZHA**

    Use a Candeo RD1P in REM mode or DPM mode to cycle through your
    favorite scenes or scripts with a double press, and trigger a dedicated
    scene or script with a long press.

    NOTE: single press and rotations are ignored in this blueprint.

    **Features:**

    - **Single press**: Ignored
    - **Double press**: Activates the current scene/script from your helper selection, then moves to the next (1 â†’ 2 â†’ â€¦ â†’ N â†’ 1)
    - **Long press**: Runs a dedicated scene or script
    - **Rotary control:** Ignored

    âš¡ **Advanced features:**

    - ðŸ§© Works with both **scenes** and **scripts** via a unified selector
    - ðŸ” Helper-driven scene/script cycling to keep things predictable


    **ðŸ› ï¸ Setup Required:**

    Create a dropdown helper:

    Settings â†’ Devices & Services â†’ Helpers â†’ **Create Helper** â†’ **Dropdown**

    - Name: "RD1P Scene Index"
    - Options: 1, 2, 3, 4, 5, 6 (set the range to match how many scenes/scripts you configure below)


    **How It Works:**

    - **Double Press**: Runs the scene/script whose index matches the helper, then advances the helper to the next option with wrap-around
    - **Long Press**: Runs the dedicated scene/script (independent of the helper)


    **Requirements:**

    - C-ZB-RD1P device in Remote Mode or Dual Purpose Mode
    - ZHA with device actions available

    **Version**: 1.0

    **Compatible Devices**: Candeo C-ZB-RD1P (Remote Mode or Dual Purpose Mode)
  domain: automation
  homeassistant:
    min_version: 2024.6.0

  input:
    remote_device:
      name: Candeo RD1-Pro Dimming Switch
      description: The C-ZB-RD1P device in remote mode or dual purpose mode.
      selector:
        device:
          filter:
            - integration: zha
              manufacturer: Candeo
              model: C-ZB-RD1P-REM
            - integration: zha
              manufacturer: Candeo
              model: C-ZB-RD1P-DPM

    scene_helper:
      name: Scene Cycle Helper (Your Helper)
      description: "Input select dropdown whose options are numeric strings, e.g. 1..N, matching the scenes/scripts you configure below."
      selector:
        entity:
          filter:
            domain: input_select

    # Scenes / Scripts (use either domain; homeassistant.turn_on supports both)
    scene_or_script_1:
      name: Scene/Script 1
      description: "Required. Runs when the helper is '1'."
      default: {}
      selector:
        target:
          entity:
            domain:
              - scene
              - script

    scene_or_script_2:
      name: Scene/Script 2 (optional)
      default: {}
      selector:
        target:
          entity:
            domain:
              - scene
              - script

    scene_or_script_3:
      name: Scene/Script 3 (optional)
      default: {}
      selector:
        target:
          entity:
            domain:
              - scene
              - script

    scene_or_script_4:
      name: Scene/Script 4 (optional)
      default: {}
      selector:
        target:
          entity:
            domain:
              - scene
              - script

    scene_or_script_5:
      name: Scene/Script 5 (optional)
      default: {}
      selector:
        target:
          entity:
            domain:
              - scene
              - script

    scene_or_script_6:
      name: Scene/Script 6 (optional)
      default: {}
      selector:
        target:
          entity:
            domain:
              - scene
              - script

    long_press_action:
      name: Long Press Scene/Script (optional)
      description: "Runs on long press; leave empty to do nothing."
      default: {}
      selector:
        target:
          entity:
            domain:
              - scene
              - script

mode: single
max_exceeded: silent

variables:
  long_press_action: !input long_press_action

triggers:
  # Press events
  - trigger: device
    device_id: !input remote_device
    domain: zha
    type: "remote_button_double_press"
    subtype: "rotary_knob"
    id: double_pressed

  # Long press
  - trigger: device
    device_id: !input remote_device
    domain: zha
    type: "remote_button_long_press"
    subtype: "rotary_knob"
    id: long_press

condition: []

action:
  - choose:
      # Double press -> run current scene/script based on helper, then advance helper
      - conditions:
          - condition: trigger
            id: double_pressed
        sequence:
          - choose:
              - conditions:
                  - condition: state
                    entity_id: !input scene_helper
                    state: "1"
                sequence:
                  - action: homeassistant.turn_on
                    target: !input scene_or_script_1
              - conditions:
                  - condition: state
                    entity_id: !input scene_helper
                    state: "2"
                sequence:
                  - action: homeassistant.turn_on
                    target: !input scene_or_script_2
              - conditions:
                  - condition: state
                    entity_id: !input scene_helper
                    state: "3"
                sequence:
                  - action: homeassistant.turn_on
                    target: !input scene_or_script_3
              - conditions:
                  - condition: state
                    entity_id: !input scene_helper
                    state: "4"
                sequence:
                  - action: homeassistant.turn_on
                    target: !input scene_or_script_4
              - conditions:
                  - condition: state
                    entity_id: !input scene_helper
                    state: "5"
                sequence:
                  - action: homeassistant.turn_on
                    target: !input scene_or_script_5
              - conditions:
                  - condition: state
                    entity_id: !input scene_helper
                    state: "6"
                sequence:
                  - action: homeassistant.turn_on
                    target: !input scene_or_script_6
          - action: input_select.select_next
            target:
              entity_id: !input scene_helper
            data:
              cycle: true

      # Long press -> run dedicated scene/script if provided
      - conditions:
          - condition: trigger
            id: long_press
        sequence:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ long_press_action.entity_id is defined }}"
                sequence:
                  - action: homeassistant.turn_on
                    target: "{{ long_press_action }}"
